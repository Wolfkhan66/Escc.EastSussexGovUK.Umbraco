@using System.Text
@using Escc.Umbraco.PropertyTypes
@using File = System.IO.File
@inherits Umbraco.Web.Mvc.UmbracoViewPage<Escc.EastSussexGovUK.Umbraco.Models.CampaignLandingViewModel>
@{
    Layout = null;
    Response.ContentType = "text/css";
    Image image = null;
    var css = new StringBuilder();
    var customCss = String.Empty;
    if (Request.QueryString["media-query"] == "small")
    {
        image = Model.BackgroundImageSmall;
        customCss = Model.CustomCssSmallScreen.ToHtmlString();
        if (Model.ButtonsTopMarginSmall.HasValue)
        {
            css.Append(".buttons { margin-top: ").Append(Model.ButtonsTopMarginSmall).Append("px; }");
        }
    }
    if (Request.QueryString["media-query"] == "medium")
    {
        image = Model.BackgroundImageMedium;
        customCss = Model.CustomCssMediumScreen.ToHtmlString();
        if (Model.ButtonsTopMarginMedium.HasValue)
        {
            css.Append(".buttons { margin-top: ").Append(Model.ButtonsTopMarginMedium).Append("px; }");
        }
        if (Model.ButtonsHorizontalAtMedium)
        {
            css.Append(File.ReadAllText(Server.MapPath("~/css/CampaignTemplates/horizontal-buttons.css")));
        }
    }
    if (Request.QueryString["media-query"] == "large")
    {
        image = Model.BackgroundImageLarge;
        customCss = Model.CustomCssLargeScreen.ToHtmlString();
        if (Model.ButtonsTopMarginLarge.HasValue)
        {
            css.Append(".buttons { margin-top: ").Append(Model.ButtonsTopMarginLarge).Append("px; }");
        }
        if (!Model.ButtonsHorizontalAtMedium)
        {
            css.Append(File.ReadAllText(Server.MapPath("~/css/CampaignTemplates/horizontal-buttons.css")));
        }
    }
    if (!String.IsNullOrEmpty(Model.BackgroundColour))
    {
        css.Append("body .body { background-color: ").Append(Model.BackgroundColour).Append("; }");
    }
    if (image != null)
    {
        var repeat = "no-repeat";
        if (Model.BackgroundImageWrapsHorizontally && Model.BackgroundImageWrapsVertically)
        {
            repeat = "repeat";
        }
        else if (Model.BackgroundImageWrapsHorizontally)
        {
            repeat = "repeat-x";
        } else if (Model.BackgroundImageWrapsVertically)
        {
            repeat = "repeat-y";
        }
        css.Append("body .body { background-image: url(").Append(image.ImageUrl).Append("; background-repeat: ").Append(repeat).Append("; }");
    }
    css.Append(customCss);
    @css
}